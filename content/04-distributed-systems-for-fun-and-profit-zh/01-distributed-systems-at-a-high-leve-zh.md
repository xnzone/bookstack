---
author: xnzone
title: "分布式系统概览"
date: 2024-09-10 10:23:32
image: /covers/distr-fun-zh.jpg
cover: false
weight: 401
tags:
  - distributed
  - system
  - CAP
  - 分布式系统
---

任何计算机系统的两项基本任务是：
- 存储
- 计算

分布式编程的艺术在于：使用多台计算机解决原本可以在单台计算机上完成的问题——通常是因为问题的规模超出了单台计算机的能力

实际上，并没有什么强制要求必须使用分布式系统。在理论上，如果拥有无限资金和研发时间，就不需要分布式系统。所有的存储和计算都可以交给一个“魔法盒”完成——*一个速度极快且高度可靠的单一系统，而且还有人帮你设计好*

然而，现实中很少有人拥有无限资源。因此我们需要在实际成本收益曲线中找到一个平衡点。在小规模下的情况下，升级软件是一种可行的策略。然而随着问题规模的增大，会达到瓶颈，此时，要么没有可以让你在单个节点上解决问题的硬件升级，要么这种升级变得成本过高。此时，欢迎你来到分布式系统的世界。

在现实场景中，中端通用硬件具有最佳性价比 -- 只要能通过软件容错降低维护成本。

计算主要受益于高端硬件，前提是它们能将慢速网络访问替换为内部内存访问。在需要大量节点通信的任务中，高端硬件的性能优势是有限的。

![](https://s2.loli.net/2024/11/18/rt2wExMBfbcoGT9.png)

如上图所示，来自[Barroso, Clidaras & Hölzle](http://www.morganclaypool.com/doi/abs/10.2200/S00516ED2V01Y201306CAC024)的研究表明，假设所有节点都采用统一的内存访问模式，高端硬件与通用硬件之间的性能差距会随着集群规模的增加而减少。


理想情况下，添加一台机器应当能够线性地提高系统的性能和容量。然而，实际上这是不可能的，因为存在由于拥有独立计算机而产生的某些开销。数据需要在各个节点之间复制，计算任务需要协调等等。这就是为什么学习分布式算法是值得的 ———— 它们提供了针对特定问题的搞笑解决方案，以及关于什么是可能的、正确实现的最低成本是什么、以及什么是不可能的指导

本文的重点是分布式编程和系统，场景虽然普通，但在商业上具有重要意义：数据中心。例如，我不会讨论由于特殊的网络配置或共享内存环境而引发的特定问题。此外，本文着重于探索系统设计领域，而不是优化某个特定设计 ———— 后者属于更专业的主题。

## 我们要实现的目标：可扩展性以及其他优势

在我看来，这一切都要源自于规模大小

大多数事情在小规模时都很简单，但同样的问题一旦超过某个规模、体积或其他物理限制，就会变得更加简单。举个例子，搬动一块巧克力很容易，搬动一座山就很难。数清楚房间里有多少人很简单，但要数清楚一个国家有多少人就很难。

因此，一切的起点是规模 ———— 可扩展性。通俗地说，在一个可扩展的系统中，当我们从小规模扩展到大规模时，情况不应该逐步恶化。这里还有一个定义：

[可扩展性](https://en.wikipedia.org/wiki/Scalability)

是指一个系统、网络或流程以高效的方式处理不断增加的工作量的能力，或其能够扩展以适应这种增长的能力。

那么，究竟是什么在增长？实际上，增长可以用几乎任何指标来衡量（如人数、电力消耗等）。但有三个特别值得关注的方面：

- **规模可扩展性**：增加更多节点应使系统性能线性提升；数据集的增长不应显著增加延迟。
- **地理可扩展性**：系统应能利用多个数据中心来减少响应用户查询所需的时间，同时以合理的方式处理跨数据中心的延迟。
- **管理可扩展性**：增加更多节点不应显著增加系统的管理成本（例如，管理员与机器的比例应保持平稳）。

当然，在实际系统中，增长通常会同时发生在多个不同的维度上；每个指标仅捕捉了增长的某个方面。

一个可扩展的系统是指在规模不断扩大时，仍能持续满足用户需求的系统。其中有两个特别重要的方面——性能和可用性，它们可以通过多种方式进行衡量。

### 性能（及时延）

[性能](https://en.wikipedia.org/wiki/Computer_performance)

是指计算机系统完成的有用工作量与所使用的时间和资源的比较。

根据上下文，这可能涉及实现以下一个或多个目标：

- 对于给定工作，短响应时间/低延迟
- 高吞吐量（处理工作的速率）
- 低计算资源利用率

在优化这些结果时，需要权衡。例如，系统可以通过处理更大批量的工作来实现更高的吞吐量，从而减少操作开销。权衡是由于批处理导致单个工作项的响应时间更长

我发现低延迟 —— 实现短响应时间 —— 是性能中最有趣的方面，因为它与物理（而非成本资源）限制有着密切的联系。使用成本资源来解决延迟问题比解决性能的其他方面要困难得多。

延迟有很多非常具体的定义，但我非常喜欢这个词的词源所唤起的概念：

延迟（Latency）

处于潜在的状态；延期（delay），某事的开始与发生之间的时间段。

那么“潜在”是什么意思呢？

潜在（Latent）

来自拉丁语latens，latentis，lateo（“隐藏”）的现在分词。存在或出现，但被隐藏或不活跃。

这个定义非常有趣，因为它突出了时延实际上是某事发生与其产生影响或变得可见之间的时间。

例如，想象一下你感染了一种空气传播的病毒，这种病毒会把人变成僵尸。延迟是指你感染的时间和你变成僵尸的时间之间的时间。这就是延迟：在某些事情已经发生但仍然被隐藏在视野之外的时间。

让我们假设我们的分布式系统只执行一个高层次的任务：给定一个查询，它会获取系统中的所有数据并计算出一个单一的结果。换句话说，可以将分布式系统视为一个数据存储，能够对其当前内容运行一个单一的确定性计算（函数）：

`result = query(all data in the system)`

那么，影响延迟的不是旧数据的数量，而是新数据在系统中“生效”的速度。例如，延迟可以通过写入变得对读者可见所需的时间来衡量。

基于这个定义的另一个关键点是，如果没有任何事情发生，就没有“延迟期（latent period）”。在数据不发生变化的系统中，不会（或不应该存在）延迟问题。

在分布式系统中，有一个无法克服的最小延迟：光速限制了信息传播的速度，硬件组件在每次操作中都有一个最低延迟的成本（考虑内存、硬盘和CPU）

最小延迟对查询的影响程度取决于查询的性质以及信息需要传播的物理距离。


