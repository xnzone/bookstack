---
author: xnzone 
title: 网络层 
date: 2023-02-27 10:04:00
image: /covers/network.jpg
cover: false
math: true
weight: 11
tags: ["王道408", "计算机网络","网络层"]
---

## 功能概述

主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务

网络层传输单位是数据报

### 功能

1. 路由选择与分组转发
2. 异构网络互联
3. 拥塞控制：开环控制(静态)，闭环控制(动态)

若所有节点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此需要采取措施，缓解拥塞

## IP数据报格式

![](https://jihulab.com/xnzone/earth-bear/-/raw/master/network-ip-data-format.jpg)

- 1B=8b
- 版本：IPv4/IPv6
- 首部长度：单位是4B，最小为5
- 区分服务：指示期望获得哪种类型的服务
- 总长度：首部+数据，单位是1B
- 生存空间(TTL): IP分组的保质期。经过一个路由-1，变成0则丢弃
- 协议：数据部分的协议
- 首部校验和：只校验首部
- 源IP地址和目的IP地址：3892位
- 可选字段：0～40B，用来支持排错、测量以及安全措施
- 填充：全0，把首部补成4B的整数倍


**数据部分的协议**

|协议名|ICMP|IGMP|TCP|EGP|IGP|UDP|IPv6|ESP|OSPF|
|---|---|---|---|---|---|---|---|---|---|
|字段值|1|2|6|8|9|17|41|50
89|


## IP数据报分片

### 最大传送单元MTU

链路层数据帧可封装数据的上限

以太网的MTU时1500字节

如果传输的数据报长度大于MTU，就需要分片

### 数据报格式

标识：同一数据报的分片使用同一标识

标志：只有2位有意义：DF,MF

中间位DF(Don't Fragment)：DF=1，禁止分片；DF=0，允许分片

最低位MF(More Fragment)：MF=1，后面还有分片；MF=0，代表最后一片/没有分片

片偏移：指出较长分组分片后，某分片在原分组中的相对位置(以8B为单位，除了最后一个分片，每个分片长度一定是8B的整数倍)

单位：总长度单位是1B，片偏移单位是8B，首部长度单位是4B

## IPv4地址

### IP编址的历史阶段

分类的IP地址

子网划分

构成超网(五分类编址方法)

### 分类的IP地址

IP地址：全世界唯一的32位/4字节标识符，标识路由器主机的接口

IP地址：={<网络号>,<主机号>}

|网络类别|最大可用网络数|第一个可用的网络号|最后一个可用的网络号|每个网络中最大的主机数|
|---|---|---|---|---|
|A| $2^7-2$ | 1 | 126 | $2^{24} - 2$|
|B| $2^{14}-1$ | 128.1|191.255|$2^{16}-2$|
|C| $2^{21}-1$| 192.0.1|223.255.255| $2^8-1$|

