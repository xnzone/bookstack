---
author: xnzone 
title: 传输层 
date: 2023-02-27 10:04:00
image: /covers/network.jpg
cover: false
math: true
weight: 12
tags: ["王道408", "计算机网络","传输层"]
---

## 功能概述

传输层只有主机才有的层次，为应用层提供通信服务使用网络层的服务

### 传输层功能

1. 传输层提供进程和进程之间的逻辑通信
2. 复用和分用
3. 传输层对收到的报文进行差错校验

<br />
复用：应用层所有的应用进程都可以通过传输层使用同一个传输协议再传输到网络

分用：传输层从网络层收到数据后交付指明的应用进程

### 传输层两个协议

1. 面向连接的传输控制协议TCP
2. 无连接的用户数据报协议UDP

<br/>
TCP：传送数据之前必须建立连接，数据传送结束后要释放连接。不提供广播或多播服务。由于TCP要提供可靠的面向连接的传输服务，因此不可避免增加了许多开销：确认、流量控制、计时器及连接管理等。可靠、面向连接、时延大，适用于大文件

UDP：传送数据之前不需要建立连接，收到UDP报文后也不需要给出任何确认。不可靠、无连接、时延小，适用于小文件

### 传输层寻址与端口

端口是传输层SAP，标识主机中的应用进程

端口号只有本地意义，在因特网中不同计算机的相同端口是没有联系的

端口号长度是16bit，能表示65536个不同端口号

熟知端口号：0-1023给TCP/IP最重要的一些应用程序，让所有用户都知道

登记端口号：1024～49151 没有熟知端口号的应用程序使用的

客户端使用的端口号：49152～65535仅在客户端进程运行时才动态选择

### 套接字

在网络中采用发送方和接收方的套接字组合来识别端点。套接字为宜标识了网络中的一个主机和它上面的进程

套接字Socket = (主机IP地址，端口号)


## UDP协议

概述：UDP只在IP数据报服务智商增加了很少检测功能

### 主要特点

UDP是无连接的，减少开销和发送数据之间的时延

UDP使用最大努力交付，即不保证可靠交付

UDP是面向报文的，适合一次性传输少量数据的网络应用

应用层给UDP多长的报文，UDP就照样发送，即一次发一个完整的报文

UDP无拥塞控制，适合很多实时应用

UDP首部开销小，8B，TCP要20B

### UDP首部格式

![](https://jihulab.com/xnzone/earth-bear/-/raw/master/network-transport-udp-head.jpg)

发送时，找不到对应的目的端口号，就丢弃报文，并给发送方发送ICMP端口不可达差错报文

### UDP校验

![](https://jihulab.com/xnzone/earth-bear/-/raw/master/network-transport-udp-check.jpg)

伪首部只有在计算校验和时才出现，不向下传送也不向上递交

封装UDP报文的IP数据报首部协议字段时17

UDP长度：UDP首部8B+数据部分长度(不包括伪首部)

**在发送端**

填上伪首部，全0填充校验和字段，全0填充数据部分(UDP数据报要看成许多4B的字串接起来)

伪首部+首部+数据部分采用二进制反码求和

把和求反码填入校验和字段

去掉伪首部，发送

**在接收端**

填上伪首部

伪首部+首部+数据部分采用二进制反码求和

结果全为1则无差错，否则丢弃数据报/交给应用层附上出差错的警告

## TCP协议

### TCP特点

TCP面向连接(需连接)的传输层协议

每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的

TCP提供可靠交付的服务，无差错、不丢失、不重复、按序到达

TCP提供全双工通信，面向字节流

发送缓存：准备发送的数据&已发送但未收到确认的数据

接收缓存：按序到达但尚未被接受应用程序读取的数据&不按序列到达的数据

TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流